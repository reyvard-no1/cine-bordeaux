<div class="mb-8">
  <h1 class="text-4xl font-bold text-gray-900 mb-2">ðŸŽ¬ Ma Wishlist</h1>
  <p class="text-gray-600">Les films que vous souhaitez voir</p>
</div>

<!-- Filtres par statut -->
<div class="flex gap-2 mb-6">
  <%= link_to "Tous", wishlists_path,
      class: "px-4 py-2 rounded-lg #{params[:status].blank? ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'} transition" %>
  <%= link_to "Ã€ voir", wishlists_path(status: 'to_watch'),
      class: "px-4 py-2 rounded-lg #{params[:status] == 'to_watch' ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'} transition" %>
  <%= link_to "En cours", wishlists_path(status: 'watching'),
      class: "px-4 py-2 rounded-lg #{params[:status] == 'watching' ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'} transition" %>
  <%= link_to "Vus", wishlists_path(status: 'watched'),
      class: "px-4 py-2 rounded-lg #{params[:status] == 'watched' ? 'bg-yellow-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'} transition" %>
</div>

<% if @wishlists.any? %>
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
    <% @wishlists.each do |wishlist| %>
      <div class="bg-white rounded-lg shadow-md overflow-hidden hover:shadow-xl transition-shadow">
        <div class="flex">
          <!-- Affiche -->
          <div class="w-32 flex-shrink-0">
            <%= link_to movie_path(wishlist.movie.tmdb_id) do %>
              <% if wishlist.movie.poster_url %>
                <%= image_tag wishlist.movie.poster_full_url,
                    alt: wishlist.movie.title,
                    class: "w-full h-full object-cover" %>
              <% else %>
                <div class="w-full h-full bg-gray-200 flex items-center justify-center text-3xl">
                  ðŸŽ¬
                </div>
              <% end %>
            <% end %>
          </div>

          <!-- Infos -->
          <div class="flex-1 p-4 flex flex-col">
            <%= link_to movie_path(wishlist.movie.tmdb_id), class: "hover:text-yellow-600 transition" do %>
              <h3 class="font-bold text-lg mb-1 line-clamp-2"><%= wishlist.movie.title %></h3>
            <% end %>

            <p class="text-sm text-gray-500 mb-2">
              <%= wishlist.movie.release_year || 'N/A' %>
            </p>

            <!-- Statut -->
            <div class="mb-3">
              <span class="inline-block px-3 py-1 rounded-full text-sm font-semibold
                <%= case wishlist.status
                    when 'to_watch' then 'bg-blue-100 text-blue-800'
                    when 'watching' then 'bg-yellow-100 text-yellow-800'
                    when 'watched' then 'bg-green-100 text-green-800'
                    end %>">
                <%= case wishlist.status
                    when 'to_watch' then 'ðŸ“Œ Ã€ voir'
                    when 'watching' then 'â–¶ï¸ En cours'
                    when 'watched' then 'âœ“ Vu'
                    end %>
              </span>
            </div>

            <!-- Actions -->
            <div class="mt-auto flex gap-2">
              <!-- Changer statut -->
              <% if wishlist.to_watch? %>
                <%= button_to "â–¶ï¸", wishlist_path(wishlist), method: :patch, params: { wishlist: { status: 'watching' } },
                    class: "px-3 py-1 bg-yellow-500 text-white rounded hover:bg-yellow-600 transition text-sm",
                    title: "Marquer en cours" %>
              <% end %>

              <% if wishlist.watching? %>
                <%= button_to "âœ“", wishlist_path(wishlist), method: :patch, params: { wishlist: { status: 'watched' } },
                    class: "px-3 py-1 bg-green-500 text-white rounded hover:bg-green-600 transition text-sm",
                    title: "Marquer comme vu" %>
              <% end %>

              <!-- Supprimer -->
              <%= button_to "ðŸ—‘ï¸", wishlist_path(wishlist), method: :delete,
                  class: "px-3 py-1 bg-red-500 text-white rounded hover:bg-red-600 transition text-sm",
                  data: { turbo_confirm: "Retirer ce film de votre wishlist ?" },
                  title: "Retirer" %>
            </div>
          </div>
        </div>
      </div>
    <% end %>
  </div>
<% else %>
  <div class="text-center py-12 bg-white rounded-lg shadow-md">
    <p class="text-gray-500 text-xl mb-4">ðŸ“­ Votre wishlist est vide</p>
    <%= link_to "DÃ©couvrir des films", root_path,
        class: "inline-block bg-yellow-500 hover:bg-yellow-600 text-white px-6 py-3 rounded-lg font-semibold transition" %>
  </div>
<% end %>
